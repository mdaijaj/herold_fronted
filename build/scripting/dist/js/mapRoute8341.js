!function(){"use strict";var e=window.matchMedia("(max-width: 767px)"),t="display:block !important",n="display:block",o="display:none !important",i={boundsOfAT:[[9.4,49],[17.15,46.4]],layers:[{active:!0,name:"Karte",style:"mapbox://styles/mapbox/streets-v10",selected:!0},{active:!0,name:"Hybrid",style:"mapbox://styles/mapbox/satellite-streets-v9",selected:!1},{active:!0,name:"Luftbilder",style:"mapbox://styles/mapbox/satellite-v9",selected:!1}],basic:{style:"mapbox://styles/mapbox/streets-v10",iconPosition:"bottom-right",dragRotate:!1,dragPan:!0,touchZoomRotate:!0,trackResize:!0,attributionControl:!1,padding:{top:40,right:50,bottom:20,left:20},animateDuration:300,animateSpeed:2,maxZoom:18},resultList:{container:"mainMap",zoom:14.5,padding:{top:40,right:50,bottom:20,left:20},interactive:!0},overlay:{container:"overlayMap",zoom:14.5,padding:{top:40,right:50,bottom:20,left:20},interactive:!0,scrollZoom:!0},iframe:{container:"map",zoom:12,padding:{top:20,right:20,bottom:20,left:20},interactive:!0},route:{container:"map",zoom:14.5,padding:{top:50,right:100,bottom:10,left:520},interactive:!0,scrollZoom:!0}},r={tl:"top-left",tr:"top-right",bl:"bottom-left",br:"bottom-right"};function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,"hbdmap",void 0),s(this,"_map",void 0),s(this,"_container",void 0),s(this,"_popup",void 0),this.hbdmap=e}var n,o;return n=t,(o=[{key:"onAdd",value:function(t){return this._map=t,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl mapboxgl-ctrl-group toGroup d-block",this._container.appendChild(this.createPopup()),this._container.appendChild(this.createButton()),e.matches||(this._container.addEventListener("mouseenter",(function(e){e.target.parentNode.querySelector("#poiList").classList.toggle("hidden")})),this._container.addEventListener("mouseleave",(function(e){e.target.parentNode.querySelector("#poiList").classList.toggle("hidden")}))),this._container}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map=void 0}},{key:"hideMe",value:function(){this._popup.classList.add("hidden")}},{key:"createPopup",value:function(){var e=this;this._popup=document.createElement("div"),this._popup.setAttribute("id","poiList"),this._popup.className="mapControlPopup hidden";var t=document.createElement("ul");return t.className="row inner",this.hbdmap.poiconfig.forEach((function(n){if(!n.hidden){var o=document.createElement("li");o.className="col-24"+(n.defaultsel?" selected":""),o.setAttribute("data-value",n.id);var i=document.createElement("span");i.innerHTML=n.label,o.appendChild(i),t.appendChild(o),o.addEventListener("click",(function(t){var n;n="LI"==t.target.tagName.toUpperCase()?t.target:t.target.parentNode;var o=$(n).find("i");n.classList.contains("selected")?(o.removeClass("icon-check"),o.addClass("icon-check-empty")):(o.removeClass("icon-check-empty"),o.addClass("icon-check")),$(n).toggleClass("selected"),e.hbdmap.poiconfig.forEach((function(e){e.id==n.dataset.value&&(e.defaultsel=n.classList.contains("selected"))})),e.hbdmap.getPOIs("route")}))}})),this._popup.appendChild(t),this._popup}},{key:"createButton",value:function(){var t=document.createElement("button");return t.className="mapboxgl-ctrl-icon mapboxgl-ctrl-poiView",t.setAttribute("type","button"),t.setAttribute("title","Anzeige der POI ändern"),t.setAttribute("aria-label","Anzeige der POI ändern"),e.matches&&t.addEventListener("touchend",(function(e){e.target.parentNode.querySelector("#poiList").classList.toggle("hidden"),e.target.parentNode.querySelector("#styleList").classList.add("hidden")})),t}}])&&a(n.prototype,o),t}();function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"_map",void 0),l(this,"_container",void 0),l(this,"_popup",void 0)}var n,o;return n=t,(o=[{key:"onAdd",value:function(t){return this._map=t,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl mapboxgl-ctrl-group d-block",this._container.appendChild(this.createPopup()),this._container.appendChild(this.createButton()),e.matches||(this._container.addEventListener("mouseenter",(function(e){e.target.parentNode.querySelector("#styleList").classList.toggle("hidden")})),this._container.addEventListener("mouseleave",(function(e){e.target.parentNode.querySelector("#styleList").classList.toggle("hidden")}))),this._container}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map=void 0}},{key:"hideMe",value:function(){this._popup.classList.add("hidden")}},{key:"createPopup",value:function(){var e=this;this._popup=document.createElement("div"),this._popup.setAttribute("id","styleList"),this._popup.className="mapControlPopup hidden";var t=document.createElement("ul");return t.className="row inner",i.layers.forEach((function(n){var o=document.createElement("li");o.className="col-24"+(n.selected?" selected":""),o.setAttribute("data-value",n.name.toLowerCase()),o.setAttribute("data-style",n.style);var i=document.createElement("span");i.innerHTML=n.name,o.appendChild(i),t.appendChild(o),o.addEventListener("click",(function(t){var n;n="LI"==t.target.tagName.toUpperCase()?t.target:t.target.parentNode,e._map.setStyle($(n).data("style"));var o=new MapboxLanguage({defaultLanguage:"de"});e._map.addControl(o),$("#styleList .selected").removeClass("selected"),$(n).addClass("selected"),$("#styleList .icon-ok").removeClass("icon-ok").addClass("icon-missing"),$(n).find("i").removeClass("icon-missing").addClass("icon-ok")}))})),this._popup.appendChild(t),this._popup}},{key:"createButton",value:function(){var t=document.createElement("button");return t.className="mapboxgl-ctrl-icon mapboxgl-ctrl-styles",t.setAttribute("type","button"),t.setAttribute("title","Ansicht ändern"),t.setAttribute("aria-label","Ansicht ändern"),e.matches&&t.addEventListener("touchend",(function(e){e.target.parentNode.querySelector("#styleList").classList.toggle("hidden"),e.target.parentNode.querySelector("#poiList")&&e.target.parentNode.querySelector("#poiList").classList.add("hidden")})),t}}])&&u(n.prototype,o),t}();function d(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"urls",{url_geocode_forward:"/servlet/geocode",url_geocode_reverse:"/servlet/reversegeocode"}),h(this,"asyncFlag",!0)}var t,n;return t=e,(n=[{key:"query",value:function(e,t){$.ajax({async:this.asyncFlag,type:"GET",url:this.urls.url_geocode_forward,context:this,data:{query:e.query,proximity:e.center},dataType:"JSON",success:function(n){var o={results:{type:"FeatureCollection",query:e.query,features:[]}};n.hasOwnProperty("features")&&$(n.features).each((function(){this.properties={},this.geometry={type:"Point",coordinates:this.center},o.results.features.push(this)})),t.call(this,o)}})}},{key:"reverseQuery",value:function(e,t){$.ajax({async:this.asyncFlag,type:"GET",url:this.urls.url_geocode_reverse,context:this,data:{lat:e.lat,lng:e.lng},dataType:"JSON",success:function(n){var o={type:"FeatureCollection",query:[e.lng,e.lat],features:[]};n.hasOwnProperty("features")&&$(n.features).each((function(){this.properties={},this.geometry={type:"Point",coordinates:o.query},o.features.push(this)})),t.call(this,o)}})}},{key:"setAsync",value:function(e){this.asyncFlag=e}}])&&d(t.prototype,n),e}();function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function y(e,t,n){return y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}},y(e,t,n||e)}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function g(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function C(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x=function(){function e(){w(this,e),_(this,"center",[]),_(this,"geometry",{coordinates:[],type:""}),_(this,"properties",{id:"",symbol:""}),_(this,"place_name","")}return C(e,[{key:"setCoordinates",value:function(e){return this.center=e,this.geometry={},this.geometry.type="Point",this.geometry.coordinates=e,this}},{key:"setId",value:function(e){return this.properties.id=e,this.properties.symbol="pin"+e,this}},{key:"setName",value:function(e){return this.place_name=e,this}},{key:"build",value:function(){return this}}]),e}(),E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(i,e);var t,n,o=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=k(t);if(n){var i=k(this).constructor;e=Reflect.construct(o,arguments,i)}else e=o.apply(this,arguments);return g(this,e)});function i(){var e;w(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return _(b(e=o.call.apply(o,[this].concat(n))),"geocoderHBD",new m),e}return C(i,[{key:"build",value:function(){var e=this;return y(k(i.prototype),"build",this).call(this),this.geocoderHBD.setAsync(!1),this.geocoderHBD.query({query:this.place_name,center:[47.6964719,13.3457347].toString()},(function(t){e.center=t.results.features[0].geometry.coordinates,e.geometry={},e.geometry.type="Point",e.geometry.coordinates=t.results.features[0].geometry.coordinates})),this}}]),i}(x);function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var R=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),O(this,"_map",void 0),O(this,"_container",void 0),O(this,"hbdmap",void 0),O(this,"locationHTML",'<button class="mapboxgl-ctrl-icon mapboxgl-ctrl-location" type="button" title="Mein Standort" aria-label="Mein Standort"></button>'),this.hbdmap=t}var t,n;return t=e,(n=[{key:"onAdd",value:function(e){var t=this;return this._map=e,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl mapboxgl-ctrl-group toGroup d-block",this._container.innerHTML=this.locationHTML,this._container.addEventListener("click",(function(){t.getLocation()})),this._container}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map=void 0}},{key:"getLocation",value:function(){var e=this,t=[];this.hbdmap.myLocation?this.hbdmap.flyMeTo(this.hbdmap.myLocation.geometry.coordinates,null,5,i[this.hbdmap.type].zoom):navigator.geolocation?navigator.geolocation.getCurrentPosition((function(n){t=[n.coords.longitude,n.coords.latitude],e.hbdmap.myLocation=(new x).setId("MyLocation").setName("Mein Standort").setCoordinates(t).build(),e.hbdmap.checkPredefinedPoints()||(e.hbdmap.setPin("location",e.hbdmap.myLocation,!1),e.hbdmap.flyMeTo(t,null,5,i[e.hbdmap.type].zoom)),"function"==typeof e.hbdmap.checkRouteComplete&&e.hbdmap.checkRouteComplete()}),(function(t){console.log(t.message),$(".mapboxgl-ctrl-location").parent().remove(),e.hbdmap.checkPredefinedPoints()})):(console.log("Geolocation is not supported by this browser."),$(".mapboxgl-ctrl-location").parent().remove(),this.hbdmap.checkPredefinedPoints())}}])&&L(t.prototype,n),e}();function T(e,t,n,o,i){var r={Kategorie:e,Action:t,event:"genericEvent"};n&&(r.Label=n),o&&(r.Wert=o),i&&(r.clickLocation=i),dataLayer.push(r)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function A(e,t,n){return t&&S(e.prototype,t),n&&S(e,n),e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N=function(){function e(){M(this,e),I(this,"map",void 0),I(this,"marker",void 0),I(this,"type",void 0),I(this,"offset",0),I(this,"hasPopup",!0),I(this,"elementId","")}return A(e,[{key:"setType",value:function(e){return this.type=e,this}},{key:"setOffset",value:function(e){return this.offset=e,this}},{key:"setPopup",value:function(e){return this.hasPopup=e,this}},{key:"build",value:function(e,t){var n=this;this.map=e,this.marker=t;var o=HTMLElement;o=document.createElement("div");var r=HTMLElement;"marker"==this.type?this.elementId=this.type+this.marker.properties.uid:"searchPin"==this.type?this.elementId=this.type+this.marker.id:"reverseSearchMarker"==this.type?this.elementId=this.type:(this.marker.properties.uid&&(o.id=this.type+this.marker.properties.uid),this.elementId=this.type+this.marker.properties.id),$("#"+this.elementId).length&&$("#"+this.elementId).remove(),this.marker.properties.newStyle?(o.className="customPin",(r=document.createElement("div")).className="hbdpin "+this.type,r.id=this.elementId,"routePin"==this.type&&r.id.indexOf("waypoint")>=0&&(r.className+=" routeWaypoint"),this.marker.properties.tag&&r.setAttribute("data-before",this.marker.properties.tag)):this.marker.properties["marker-symbol"]?((r=document.createElement("div")).id=this.elementId,r.className+=this.type+" pin "+this.marker.properties["marker-symbol"],this.marker.properties["marker-color"]?r.style.backgroundImage="url('https://a.tiles.mapbox.com/v4/marker/pin-m-"+this.marker.properties["marker-symbol"]+this.marker.properties["marker-color"].replace("#","+")+".png?access_token="+this.map.key+"')":r.style.backgroundImage="url('https://a.tiles.mapbox.com/v4/marker/pin-m-"+this.marker.properties["marker-symbol"]+".png?access_token="+this.map.key+"')"):this.marker.properties.icon?((r=document.createElement("img")).id=this.elementId,r.className+=this.type+" image "+this.marker.properties.category,r.src=t.properties.icon.iconUrl):((r=document.createElement("img")).id=this.elementId,r.setAttribute("src","/images/mapPins/reverseSearch.svg"),r.className=this.type+" hbdpin fallback",o.style.zIndex=101),r.setAttribute("data-has-popup",this.hasPopup),o.appendChild(r);var a=new mapboxgl.Marker(o).setLngLat(t.geometry.coordinates);if(this.hasPopup){var s=new mapboxgl.Popup({offset:this.offset,anchor:"top"}).setDOMContent((new j).setType(this.type).build(this.map,this.marker)).on("open",(function(e){n.map.currentPopup=s;var t=e.target._lngLat,o=0-$(e.target._container).outerHeight()/3;$("#detailBox.mapview").length||$("#searchresult.mapview").length||$("body.site_RP").length||($(".map-toggle-on").click(),setTimeout((function(){n.map.flyMeTo(t,[0,o])}),i.basic.animateDuration)),T("map pin","click",n.marker.properties.id)})).on("close",(function(e){}));a.setPopup(s)}return a.addTo(this.map.map),a}}]),e}(),j=function(){function e(){M(this,e),I(this,"map",void 0),I(this,"marker",void 0),I(this,"type",void 0)}return A(e,[{key:"setType",value:function(e){return this.type=e,this}},{key:"build",value:function(e,t){var n=this;this.map=e,this.marker=t;var o=document.createElement("div");o.className="popupContentNew";var i=this.marker.properties;if($.isEmptyObject(i)){var r=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),u=document.createElement("div");r.className=a.className="row",s.className="col-22",c.className=u.className="col-12 groupPadding";var l=document.createElement("img");l.setAttribute("src","/images/mapPins/pin.svg");var p=document.createElement("div");p.innerHTML="<p><b>"+t.place_name.replace(", Österreich","")+"</b></p><p>"+t.center[1]+", "+t.center[0]+"</p>";var d=document.createElement("button");d.className="btn btn-md btn-hbd btn-light-yellow fullWidth setRoutePin",d.setAttribute("type","button"),d.setAttribute("data-poi-action","origin"),d.innerHTML="Route von hier",d.addEventListener("click",(function(){n.map.setPin("origin",t),n.map.planRoute.setRouteItem("origin",t),n.map.checkRouteComplete()}));var h=document.createElement("button");h.className="btn btn-md btn-hbd btn-light-yellow fullWidth setRoutePin",h.setAttribute("type","button"),h.setAttribute("data-poi-action","destination"),h.innerHTML="Route hierher",h.addEventListener("click",(function(){n.map.setPin("destination",t),n.map.planRoute.setRouteItem("destination",t),n.map.checkRouteComplete()})),r.appendChild(s).appendChild(l),r.appendChild(s).appendChild(p),o.appendChild(r),a.appendChild(c).appendChild(d),a.appendChild(u).appendChild(h),o.appendChild(a)}else{var m;if(i.iframe_width&&o.setAttribute("style","width: "+i.iframe_width+"px;"),(m=document.createElement("span")).setAttribute("class","close"),m.innerHTML='<i class="icon-close" />',m.addEventListener("click",(function(){$(".mapboxgl-popup-close-button").click()})),o.appendChild(m),i.title){var f,y=document.createElement("div");y.setAttribute("class","headline"),i.hasOwnProperty("link")&&""!=i.link?((f=document.createElement("a")).setAttribute("href",i.link),f.setAttribute("target","_blank"),f.setAttribute("title","Öffnet neues Fenster")):f=document.createElement("span"),f.innerHTML="<h3>"+i.title+"</h3>",y.appendChild(f),o.appendChild(y)}if(i.category){var v=document.createElement("p");v.setAttribute("class","category"),v.innerHTML=i.category,o.appendChild(v)}if(i.hasOwnProperty("ratingstotal")&&i.ratingstotal>0){var g=Math.round(i.ratingsavg),b=5-g,k=document.createElement("div");k.setAttribute("class","company-rating");for(var w="",P=0;P<g;P++)w+='<i class="icon icon-star active"></i>';for(var C=0;C<b;C++)w+='<i class="icon icon-star"></i>';w+='<b class="rating-average pl-2">'+i.ratingsavg.toFixed(1).replace(".",",")+'</b><span class="rating-total">&nbsp;('+i.ratingstotal+")</span>",k.innerHTML=w,o.appendChild(k)}if(i.iframe_width&&i.iframe_height&&i.iframe_url){var _=document.createElement("iframe");_.setAttribute("style","width:"+i.iframe_width+"px;height:"+i.iframe_height+"px;border:0)"),_.setAttribute("src",i.iframe_url),_.setAttribute("allowfullscreen",""),o.appendChild(_)}if(i.image){var x=document.createElement("img");x.setAttribute("src",i.image),x.setAttribute("alt",""),x.innerHTML="<p>"+i.address+"</p>",o.appendChild(x)}if(i.hasOwnProperty("address")){var E=document.createElement("div");E.setAttribute("class","address"),E.innerHTML="<p>"+i.address+"</p>",o.appendChild(E)}if(i.hasOwnProperty("text")){var L=document.createElement("p");L.innerHTML=i.text,o.appendChild(L)}if(i.businessHoursSet&&"true"==i.businessHoursSet&&(i.businessHoursStatus||i.businessHoursText)){var O=document.createElement("div");O.setAttribute("class","openingHours status "+i.businessHoursClass),O.setAttribute("title","Öffnungszeiten heute");var R=document.createElement("i");if(R.setAttribute("class","icon-clock ml-2"),O.appendChild(R),i.businessHoursStatus){var M=document.createElement("span");M.setAttribute("class","status mx-2"),M.appendChild(document.createTextNode(i.businessHoursStatus+" ")),O.appendChild(M)}if(i.businessHoursText){var S=document.createElement("span");S.setAttribute("class","slot"),S.appendChild(document.createTextNode(i.businessHoursText)),O.appendChild(S)}o.appendChild(O)}if(i.hasOwnProperty("source")||i.hasOwnProperty("sourceimg")){var A,I=document.createElement("p");I.setAttribute("class","text-muted small"),A=i.hasOwnProperty("sourceimg")?'<img src="'+i.sourceimg+'" alt="'+i.source+'"/>':i.source,i.hasOwnProperty("sourcelink")&&""!=i.sourcelink?I.innerHTML='<a href="'+i.sourcelink+'" rel="noopener" target="_blank" title="Öffnet neues Fenster">'+A+"</a>":I.innerHTML=A,o.appendChild(I)}if(i.hasOwnProperty("to")||i.hasOwnProperty("phonenumber")){var N,j=document.createElement("div");if(j.setAttribute("class","functions"),i.hasOwnProperty("sid")?N="YP:"+i.sid:i.hasOwnProperty("pid")&&(N="WP:"+i.pid),i.hasOwnProperty("to")){var H=document.createElement("a");H.setAttribute("class","btn btn-hbd gray"),H.setAttribute("href",i.to),H.setAttribute("target","_top"),H.innerHTML="Route planen",H.addEventListener("click",(function(){T("get direction"+i.pageType,"click",N,"inmap")})),j.appendChild(H)}if(i.hasOwnProperty("phonenumber")){var B=document.createElement("div");B.setAttribute("class","buttonPhone");var D=document.createElement("a");D.setAttribute("class","d-flex d-md-none btn-hbd yellow hasIcon"),D.setAttribute("href","tel:"+i.phonenumber),D.setAttribute("target","_top"),D.innerHTML='<i class="icon-phone"></i>Anrufen',D.addEventListener("click",(function(){T("Telefonnummer_result","call",N,"inmap")}));var z=document.createElement("a");z.setAttribute("class","d-none d-md-block btn btn-hbd yellow fullWidth callPhone hidden ellipsis"),z.setAttribute("href","tel:"+i.phonenumber),z.setAttribute("target","_top"),z.innerHTML=i.phonenumber,z.addEventListener("click",(function(){T("Telefonnummer_result","call",N,"inmap")}));var F=document.createElement("button");F.setAttribute("class","d-none d-md-flex btn btn-hbd yellow hasIcon fullWidth showPhone switch"),F.innerHTML='<i class="icon-phone"></i>Nr. anzeigen',F.addEventListener("click",(function(){T("Telefonnummer_result","show",N,"inmap"),this.previousSibling.classList.remove("hidden"),this.parentNode.removeChild(this)})),B.appendChild(D),B.appendChild(z),B.appendChild(F),j.appendChild(B)}o.appendChild(j)}}return o}}]),e}();function H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function D(e,t,n){return t&&B(e.prototype,t),n&&B(e,n),e}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=function(){function e(t){H(this,e),z(this,"_map",void 0),z(this,"_container",void 0),z(this,"locationHTMLnoText",'<button class="mapboxgl-ctrl-icon mapboxgl-ctrl-overlay" type="button" data-toggle="modal" data-target="#overlayMapModal" aria-label="Toggle bigger view"></button>'),z(this,"locationHTMLwithText",'<button class="mapboxgl-ctrl-icon mapbox-ctrl-text mapboxgl-ctrl-overlay" type="button" data-toggle="modal" data-target="#overlayMapModal" aria-label="Toggle bigger view"><span class="d-none d-md-block medium">Karte vergrößern</span></button>'),z(this,"tracking",""),this.tracking=t}return D(e,[{key:"onAdd",value:function(e){var t=this;return this._map=e,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl mapboxgl-ctrl-group toGroup d-block",$(this._map._container).data("overlay-text")?this._container.innerHTML=this.locationHTMLwithText:this._container.innerHTML=this.locationHTMLnoText,this._container.addEventListener("click",(function(){T("show map","click",t.tracking)})),this._container}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map=void 0}}]),e}(),q=function(){function e(){H(this,e),z(this,"_map",void 0),z(this,"_container",void 0),z(this,"locationHTML",'<button class="mapboxgl-ctrl-icon mapbox-ctrl-text mapboxgl-ctrl-close" type="button" class="close" data-dismiss="modal" aria-label="Close"><span class="d-none d-md-block medium">Karte schließen</span></button>')}return D(e,[{key:"onAdd",value:function(e){return this._map=e,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl mapboxgl-ctrl-group toGroup d-block",this._container.innerHTML=this.locationHTML,this._container.addEventListener("click",(function(){var e=document.querySelector(".mapboxgl-ctrl-shrink");e&&e.click()})),this._container}},{key:"onRemove",value:function(){this._container.parentNode.removeChild(this._container),this._map=void 0}}]),e}();function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}function G(e,t,n){return G="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=K(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}},G(e,t,n||e)}function W(e,t){return W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},W(e,t)}function J(e,t){if(t&&("object"===Z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function K(e){return K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},K(e)}function U(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function V(e,t,n){return t&&Q(e.prototype,t),n&&Q(e,n),e}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Y=function(){function e(){U(this,e),X(this,"$element",void 0),X(this,"$elInput",void 0),X(this,"$elButton",void 0),X(this,"$elAutosuggest",void 0),X(this,"$elUseMyLoc",void 0),X(this,"features",void 0),X(this,"selectedIndex",0),X(this,"minChar",2),X(this,"map",void 0),X(this,"geocoderHBD",new m)}return V(e,[{key:"setId",value:function(e){return this.$element=e,this.$elInput=$(e).find("input:text"),this.$elButton=$(e).find("button"),this.$elAutosuggest=$(e).find(".autosuggest"),this}},{key:"setMap",value:function(e){return this.map=e,this}},{key:"build",value:function(){var e,t=this;$(this.$elInput).on("input",(function(){clearTimeout(e),e=setTimeout((function(){t.inputEventFired()}),300)})),$(this.$elInput).on("keydown",(function(e){if(t.clearRoute($(t.$elInput).attr("id")),t.features&&t.features.features&&t.features.features.length){if(9==e.keyCode||13==e.keyCode)return 0!==t.selectedIndex?$(t.$elAutosuggest).find("li:nth-child("+t.selectedIndex+")").click():t.search(e),void(t.selectedIndex=0);38==e.keyCode?t.selectedIndex--:40==e.keyCode&&t.selectedIndex++,t.selectedIndex<=0&&(t.selectedIndex=t.features.features.length),t.selectedIndex>t.features.features.length&&(t.selectedIndex=1),38!=e.keyCode&&40!=e.keyCode||($(t.$elAutosuggest).find("li").removeClass("selected"),$(t.$elAutosuggest).find("li:nth-child("+t.selectedIndex+")").addClass("selected"))}})),$(this.$elInput).on("focusin",(function(e){$(e.currentTarget).val().length>=t.minChar&&$(t.$elAutosuggest).children().length>0&&t.$elAutosuggest.fadeIn()})),$(this.$elInput).on("focusout",(function(e){t.$elAutosuggest.fadeOut()})),$(this.$elButton).click((function(e){t.search(e)}))}},{key:"clearRoute",value:function(){return!1}},{key:"inputEventFired",value:function(){var e=$(this.$elInput).val();e.length>=this.minChar?(this.$elAutosuggest.fadeIn(),this.autosuggestMAPBOX(e)):(this.$elAutosuggest.fadeOut(),this.features=null,$(this.$elAutosuggest).children().remove()),this.selectedIndex=0}},{key:"search",value:function(e){var i=this;$(this.$elInput).val()&&(e.preventDefault(),this.map.clearMap({route:!0,pins:!0,routepins:!0}),$(this.$elAutosuggest).children().remove(),$("#search-map-result").children().remove(),this.geocoderHBD.query({query:$(this.$elInput).val(),center:this.map.getCenter().toString()},(function(e){1==e.results.features.length?(i.map.setPin("destination",e.results.features[0]),i.map.flyMeTo(e.results.features[0].center,null,null,14)):(e.results.features.forEach((function(e,r){$("#resultbar").is(":hidden")&&($(".sidebar").attr("style",o),$("#searchbar").attr("style",t),$("#resultbar").attr("style",t),$("button.close").attr("style",n)),e.properties.id=r+1,e.properties.newStyle=!0,i.createResult(e),(new Marker).setType("suggestPin").setPopup(!1).build(i.map,e)})),i.map.setCoordinates(e.results),i.map.adjustZoom())})))}},{key:"createResult",value:function(e){var t=this,n=document.createElement("li");n.className="searchSuggest",n.addEventListener("click",(function(){t.map.flyMeTo(e.center,null,null,14)}));var o=document.createElement("div");o.className="row";var i=document.createElement("div");i.className="col suggestNo customPin",i.setAttribute("data-counter",e.properties.id);var r=document.createElement("div");r.className="hbdpin listSuggestPin",r.setAttribute("id","listSuggestPin"+e.properties.id),i.appendChild(r);var a=document.createElement("div");a.className="col suggestDesc",a.innerHTML=e.place_name.replace(", Österreich","");var s=document.createElement("div");s.className="suggestButtons";var c=document.createElement("button");c.className="btn btn-empty btn-sm setRoutePin",c.setAttribute("type","button"),c.setAttribute("data-poi-action","origin"),c.setAttribute("data-point",e),c.innerHTML='<i class="icon icon-direction"></i> Start',c.addEventListener("click",(function(){t.map.setPin("origin",e),t.map.planRoute.setRouteItem("origin",e),t.map.checkRouteComplete()}));var u=document.createElement("button");u.className="btn btn-empty btn-sm setRoutePin",u.setAttribute("type","button"),u.setAttribute("data-poi-action","destination"),u.setAttribute("data-point",e),u.innerHTML='<i class="icon icon-direction"></i> Ziel',u.addEventListener("click",(function(){t.map.setPin("destination",e),t.map.planRoute.setRouteItem("destination",e),t.map.checkRouteComplete()})),s.appendChild(c),s.appendChild(u),a.appendChild(s),o.appendChild(i),o.appendChild(a),n.appendChild(o),queryEl("#search-map-result").appendChild(n)}},{key:"itemSelected",value:function(e){$(this.$elInput).val(e.place_name.replace(", Österreich","")),$(this.$elAutosuggest).children().remove(),$("#search-map-result").children().remove(),$(".searchPin").addClass("old"),this.map.setPin("destination",e),$(".searchPin.old").remove(),this.map.flyMeTo(e.center,null,null,14),this.map.planRoute.setRouteItem("destination",e),this.map.checkRouteComplete()}},{key:"autosuggestMAPBOX",value:function(e){var t,n=this,o=this.map.getCenter();t=o.lng?o.lng+","+o.lat:o.toString(),$.ajax({type:"GET",url:"https://api.mapbox.com/geocoding/v5/mapbox.places/"+e+".json",data:{country:"at",language:"de",access_token:this.map.key,proximity:t,autocomplete:!0},success:function(e){setTimeout((function(){$(n.$elAutosuggest).children().remove(),n.features=e,n.features.features.forEach((function(e,t){e.place_name=e.place_name.replace(", Österreich",""),n.features.features[t].properties["marker-symbol"]="pin"+(t+1);var o=$('<li id="'+e.id+'"/>');o.text(e.place_name),o.on("click",(function(){n.itemSelected(e)})),$(n.$elAutosuggest).append(o)}))}),250)},complete:function(){}})}}]),e}(),ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(r,e);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=K(t);if(n){var i=K(this).constructor;e=Reflect.construct(o,arguments,i)}else e=o.apply(this,arguments);return J(this,e)});function r(){return U(this,r),i.apply(this,arguments)}return V(r,[{key:"build",value:function(){G(K(r.prototype),"build",this).call(this),this.$elAutosuggest.css({top:"50px"})}},{key:"search",value:function(){$(this.$elAutosuggest).find("li:first-child").click()}},{key:"itemSelected",value:function(e){$(this.$elInput).val(e.place_name.replace(", Österreich","")),$(this.$elAutosuggest).children().remove(),$(this.$elAutosuggest).attr("style",o+";top: 50px"),this.map.setPin($(this.$elInput).attr("id"),e),this.map.planRoute.setRouteItem($(this.$elInput).attr("id"),e),this.map.checkRouteComplete()}}]),r}(Y);function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ne(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function oe(e,t,n){return t&&ne(e.prototype,t),n&&ne(e,n),e}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var re=function(){function n(){te(this,n),ie(this,"routeJSON",{}),ie(this,"routeData",void 0),ie(this,"map",void 0),ie(this,"$element",void 0),ie(this,"$elFormGroup",[]),ie(this,"nextWaypoint",0)}return oe(n,[{key:"setMap",value:function(e){return this.map=e,this}},{key:"build",value:function(){var e=this;this.$element=$("#form-search-route"),this.$element.on("submit",(function(t){t.preventDefault(),e.writeRouteSummary(),e.writeRouteSteps()})),this.$elFormGroup=$('div.form-group[id^="mapbox-directions"]'),this.$elFormGroup.each((function(t,n){(new ee).setId($(n)).setMap(e.map).build()}));var t=$("#mobileRouteTop .toggle");t.click((function(n){t.siblings(".content").toggle(),t.children('[class^="icon"]').toggleClass("icon-arrow_up icon-arrow_down"),e.map.resize()})),$("#form-search-route").on("click",".switch",(function(t){t.preventDefault();var n=new ae;n.root=$(t.currentTarget).parent().prev();var o=new ae;o.root=$(t.currentTarget).parent();var i=n.elInput.val();n.elInput.val(o.elInput.val()),o.elInput.val(i);var r=e.getRouteItem(n.dataItem);e.setRouteItem(n.dataItem,e.getRouteItem(o.dataItem)),e.setRouteItem(o.dataItem,r),e.map.clearMap({route:!1,pins:!1,routepins:!0}),e.map.setPin("origin",e.map.route.origin),e.map.route.waypoints.forEach((function(t,n){e.map.setPin("waypoint"+n.toString(),t)})),e.map.setPin("destination",e.map.route.destination),e.getRoute()})),$("#means .col").click((function(t){0==$(t.currentTarget).hasClass("active")&&($("#means .col").removeClass("active"),$(t.currentTarget).addClass("active"),e.getRoute())})),$(".addStop").click((function(t){var n=$('<div class="form-group" id="mapbox-directions-waypoint'+e.nextWaypoint+'" data-pin="routewaypoint'+e.nextWaypoint+'" data-item="waypoint'+e.nextWaypoint+'" />'),o=$('<button class="btn switch"><i class="icon icon-switch"></i></button>'),i=$('<div class="input-group ui-front">'),r=$('<div class="input-group-prepend"><label for="waypoint" class="input-group-text">&bull;</label></div><input id="waypoint'+e.nextWaypoint+'" class="form-control street" type="text" autocomplete="off" value="" required="required" name="waypoint" placeholder="Zwischenstop" data-routepoint="'+e.nextWaypoint+'" />'),a=$('<div class="btn delete"><i class="icon-minus"></i></div>');a.on("click",(function(t){n.remove(),e.map.route.waypoints.pop(e.nextWaypoint),e.map.clearMap({route:!1,pins:!1,routepins:!0}),e.map.setPin("origin",e.map.route.origin),e.map.route.waypoints.forEach((function(t,n){e.map.setPin("waypoint"+n.toString(),t)})),e.map.setPin("destination",e.map.route.destination),e.getRoute()}));var s=$('<div class="btn clear"><i class="icon-close"></i></div>');s.on("click",(function(e){r.val(""),r.focus()}));var c=$('<ul class="autosuggest" />'),u=$('<button id="waypoint'+e.nextWaypoint+'Button" class="hidden"/>');i.append(r).append(a).append(s).append(c).append(u),n.append(o).append(i),$("#mapbox-directions-destination").before(n),(new ee).setId($("#mapbox-directions-waypoint"+e.nextWaypoint)).setMap(e.map).build(),e.nextWaypoint++}))}},{key:"getRouteItem",value:function(e){if(e.indexOf("waypoint")>=0){var t=e.replace("waypoint","");return this.map.route.waypoints[t]}return this.map.route[e]}},{key:"setRouteItem",value:function(e,t){if(e.indexOf("waypoint")>=0){var n=e.replace("waypoint","");this.map.route.waypoints[n]=t}else this.map.route[e]=t}},{key:"getCurrentMean",value:function(){return $("#means .col.active").data("mean")}},{key:"getRoute",value:function(){var e=this,t=this.map.route.origin,n=this.map.route.destination,o=this.map.route.waypoints,i=this.getCurrentMean(),r="";o.forEach((function(e){r+=e.geometry.coordinates.join()+";"})),$("input#origin").val(t.place_name),$("input#destination").val(n.place_name),$.ajax({type:"GET",url:"/servlet/getroute?type="+i+"&waypoints="+t.geometry.coordinates.join()+";"+r+n.geometry.coordinates.join(),context:this,dataType:"JSON",success:function(o){e.routeJSON=o.routes[0];var i=polyline.toGeoJSON(e.routeJSON.geometry,5),r={type:"LineString",coordinates:[t.geometry.coordinates,i.coordinates[0]]},a={type:"LineString",coordinates:[i.coordinates[i.coordinates.length-1],n.geometry.coordinates]};e.map.clearMap({route:!0,pins:!0,routepins:!1}),e.drawRoutePart("start",r,-1),e.drawRoutePart("route",polyline.toGeoJSON(e.routeJSON.geometry,5),0),e.drawRoutePart("end",a,-1),e.map.coordinates=[],e.map.coordinates=i.coordinates,e.map.coordinates.unshift(t.geometry.coordinates),e.map.coordinates.push(n.geometry.coordinates),e.map.adjustZoom()},complete:function(){}})}},{key:"drawRoutePart",value:function(e,t,n){var o=this,i={"line-width":6,"line-color":"#62719E","line-opacity":.75};n>=0&&(e+=n),n<0&&(i["line-dasharray"]=[2,1]),n>0&&(i["line-color"]="#000000",i["line-opacity"]=.25);var r={name:e,source:{type:"geojson",data:{type:"Feature",geometry:t}},layer:{id:e,type:"line",source:e,paint:i,layout:{visibility:"visible"}}};!function e(){o.map.map.isStyleLoaded()?(o.map.map.addSource(r.name,r.source),o.map.map.addLayer(r.layer),o.map.additionalLayers.push(r)):setTimeout(e,200)}()}},{key:"writeRouteSummary",value:function(){var n=$('<div id="routeSummary" class="col-19"/>'),i=$("<h1>"+this.formatDuration(this.routeJSON.duration)+" ("+this.formatDistance(this.routeJSON.distance)+")</h1>"),r=$("<p>über "+this.routeJSON.legs[0].summary+"</p>"),a=$('<div class="col-5"></div>'),s=$('<div class="toggle"><i class="icon-arrow_up" aria-hidden="true"></i><p>Details</p></div>');s.click((function(e){s.children('[class^="icon"]').toggleClass("icon-arrow_up icon-arrow_down");var n=s.children("p");"Details"==n.text()?(n.text("Karte"),$("#mobileRouteBottom").css("top","45px"),$("#mobileRouteBottom .content").css("height","100%"),$("#routeSteps").attr("style",t)):(n.text("Details"),$("#mobileRouteBottom").css("top","auto"),$("#mobileRouteBottom .content").css("height","inherit"),$("#routeSteps").attr("style",o))})),$(n).append(i),$(n).append(r),e.matches?(a.append(s),$("#mobileRouteBottom").attr("style",t),$("#mobileRouteBottom .routeOverview").empty(),$("#mobileRouteBottom .routeOverview").append(n),$("#mobileRouteBottom .routeOverview").append(a)):($("#form-search-route .routeOverview").empty(),$("#form-search-route .routeOverview").append(n))}},{key:"writeRouteSteps",value:function(){var t=this,n=$('<div id="routeSteps" class="col-24"/>');this.routeJSON.legs.forEach((function(e){e.steps.forEach((function(e){var o=$('<div class="row step"/>').on("click",(function(){t.map.flyMeTo(e.intersections[0].location,null,null,14)})).on("mouseover",(function(){var n=document.createElement("div");n.className="hbdpin routeStepPin";var o=document.createElement("img");o.src="/images/mapPins/routeStep.svg",n.appendChild(o),new mapboxgl.Marker(n).setLngLat(e.intersections[0].location).addTo(t.map.map)})).on("mouseleave",(function(){$(".hbdpin.routeStepPin").remove()})),i=e.maneuver.type;e.maneuver.hasOwnProperty("modifier")&&(i+="_"+e.maneuver.modifier),i="direction_"+i.replace(/ /g,"_");var r=$('<div class="col-3 step-icon"/>').addClass(i),a=$('<div class="col-21 step-desc"/>').text(e.maneuver.instruction),s=$('<p class="step-hint"/>');e.duration>0&&s.text(t.formatDuration(e.duration)+" ("+t.formatDistance(e.distance)+")"),a.append(s),o.append(r),o.append(a),n.append(o)}))})),e.matches?(n.attr("style",o),$("#mobileRouteBottom .content .routeDesc").append(n),this.map.resize()):($(".routeDesc").empty(),$(".routeDesc").append(n))}},{key:"formatDuration",value:function(e){var t=Math.floor(e/60),n=Math.floor(t/60);return e%=60,t%=60,0===n&&0===t?parseInt(e)+" Sek.":0===n?t+" Min.":n+" Std. "+t+" Min."}},{key:"formatDistance",value:function(e){var t=e.toFixed(0)+" m";return e>=1e5?t=(e/1e3).toFixed(0)+" km":e>=1e4?t=(e/1e3).toFixed(1)+" km":e>=1e3&&(t=(e/1e3).toFixed(2)+" km"),t.replace(".",",")}},{key:"getRouteData",value:function(){var e={};return e.origin=this.map.route.origin,e.destination=this.map.route.destination,e.printaction="direction",e.profile=this.getCurrentMean(),e.routes=[],e.routes[0]=this.routeJSON,e}}]),n}(),ae=function(){function e(){te(this,e),ie(this,"root",void 0)}return oe(e,[{key:"elInput",get:function(){return this.root.children(".input-group").children("input")}},{key:"elPin",get:function(){return $("#"+this.root.data("pin"))}},{key:"dataItem",get:function(){return this.root.data("item")}}]),e}();function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function ce(e,t,n){return ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=de(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}},ce(e,t,n||e)}function ue(e,t){return ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ue(e,t)}function le(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return pe(e)}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e){return de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},de(e)}function he(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function me(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function fe(e,t,n){return t&&me(e.prototype,t),n&&me(e,n),e}function ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ve=function(i){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(c,i);var r,a,s=(r=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=de(r);if(a){var n=de(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return le(this,e)});function c(){var e;he(this,c);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return ye(pe(e=s.call.apply(s,[this].concat(n))),"enableLocation",!0),ye(pe(e),"enablePOIview",!0),ye(pe(e),"route",{origin:{},destination:{},waypoints:[]}),ye(pe(e),"lastReverseSearch",{}),ye(pe(e),"searchMarker",void 0),ye(pe(e),"geocoderHBD",new m),ye(pe(e),"planRoute",new re),e}return fe(c,[{key:"build",value:function(e){var t=this;return ce(de(c.prototype),"build",this).call(this),this.planRoute.setMap(this),this.planRoute.build(),e.length>=2?(this.checkPredefinedPoints(),this.checkRouteComplete()):this.geolocation.getLocation(this),this.map.on("click",(function(e){t.clickEvent(e)})),this.map.on("contextmenu",(function(e){t.clickEvent(e)})),$("#mobileRouteTop .toggle .icon").click((function(e){$("#mobileRouteTop .content").toggle(),$("#mobileRouteTop .toggle .icon").toggleClass("icon-arrow_up icon-arrow_down"),t.resize()})),this}},{key:"setControls",value:function(){return this.controls={zoom:"br",location:"br",poiview:"br",styles:"br",fullsize:"br"},this}},{key:"checkPredefinedPoints",value:function(){var e,t=this,n=!1;return routePoints.length&&(n=!0,routePoints.forEach((function(n){var o={start:"origin",end:"destination",via:"waypoint0"}[n.type];"waypoint0"==o&&$(".addStop").click(),$("#"+o).val(n.name),(e=n.coordinates?(new x).setId(o).setName(n.name).setCoordinates(n.coordinates).build():(new E).setId(o).setName(n.name).build()).properties.newStyle=!0,(new N).setType("routePin").setPopup(!1).build(t,e),t.flyMeTo(e.geometry.coordinates,null,5,18),t.route[o]=e}))),n}},{key:"clickEvent",value:function(e){e.preventDefault(),this.changePOIview.hideMe(),this.changeStyles.hideMe(),$("#reverseSearchMarker").length||$(".mapboxgl-popup").length?($("#reverseSearchMarker").remove(),$(".mapboxgl-popup").remove()):"CANVAS"!=e.originalEvent.target.nodeName&&$(e.originalEvent.target).data("hasPopup")||this.reverseSearch(e)}},{key:"clearMap",value:function(e){var t=this;e.route&&(this.additionalLayers.forEach((function(e){t.map.removeLayer(e.name),t.map.removeSource(e.name)})),this.additionalLayers=[],$(".routeOverview").empty(),$(".routeDesc").empty()),e.pins&&($(".mapboxgl-popup-content").remove(),$('[class^="mapboxgl-ctrl-bottom"]').css("bottom",0)),e.routepins?$(".hbdpin").remove():$('.hbdpin:not([id^="route"])').remove()}},{key:"reverseSearch",value:function(e){var t=this;this.geocoderHBD.reverseQuery(e.lngLat,(function(e){t.searchMarker=e.features[0],t.features.features.push(e.features[0]),t.searchMarker.id="reversesearchMarker";var n=(new N).setType("reverseSearchMarker").setOffset(5).setPopup(!0).build(t,t.searchMarker);t.lastReverseSearch=t.searchMarker,n.togglePopup()}))}},{key:"checkRouteComplete",value:function(){var i=(this.route.origin.properties?2:0)+(this.route.destination.properties?2:0)+(this.myLocation?1:0);if(i>=3&&(3==i&&(this.route.origin.properties||(this.route.origin=this.myLocation,this.setPin("origin",this.myLocation)),this.route.destination.properties||(this.route.destination=this.myLocation,this.setPin("destination",this.myLocation))),this.planRoute.getRoute()),i>=2){var r=this.route.origin,a=this.route.destination;$("input#origin").val(r.place_name),$("input#destination").val(a.place_name),this.clearMap({route:!0,pins:!0,routepins:!1}),!e.matches&&$("#routebar").is(":hidden")&&($(".sidebar").attr("style",o),$("#routebar").attr("style",t),$("button.close").attr("style",n)),e.matches&&($(".sidebar").attr("style",o),jQuery.isEmptyObject(this.currentPopup)||(this.currentPopup.remove(),this.currentPopup={}),$("#form-search-route").prependTo("#mobileRouteTop .content"),$("#mobileRouteTop").attr("style",t),this.resize())}}}]),c}(function(){function t(){he(this,t),ye(this,"map",void 0),ye(this,"key",void 0),ye(this,"coordinates",[]),ye(this,"type",void 0),ye(this,"controls",{zoom:"",location:"",poiview:"",styles:"",overlay:"",fullsize:"",popup:"false",tracking:""}),ye(this,"zoom",void 0),ye(this,"style",i.basic.style),ye(this,"poiconfig",void 0),ye(this,"features",void 0),ye(this,"featuresForeignAdvertiser",void 0),ye(this,"featuresNoFitBounds",void 0),ye(this,"padding",{top:0,right:0,bottom:0,left:0}),ye(this,"additionalLayers",[]),ye(this,"currentPopup",{}),ye(this,"myLocation",void 0),ye(this,"geolocation",void 0),ye(this,"changeStyles",void 0),ye(this,"changePOIview",void 0),ye(this,"findPois",void 0)}return fe(t,[{key:"setKey",value:function(e){return this.key=e,this}},{key:"setType",value:function(e){return this.type=e,this}},{key:"setControls",value:function(e){return this.controls=e,this}},{key:"setZoom",value:function(e){return this.zoom=e,this}},{key:"setStyle",value:function(e){switch(e){case"Luftbilder":this.style=i.layers.filter((function(e){return"Luftbilder"===e.name}))[0].style;break;case"Hybrid":this.style=i.layers.filter((function(e){return"Hybrid"===e.name}))[0].style;break;default:this.style=i.basic.style}return this}},{key:"setPoiconfig",value:function(e){return this.poiconfig=e,this}},{key:"setFeatures",value:function(e){return this.features=e,this}},{key:"setFeaturesAdditional",value:function(e,t){return this.featuresForeignAdvertiser=t,this.featuresNoFitBounds=e,0==this.features.features.length&&(this.features=t),this}},{key:"build",value:function(){var e=this;this.padding=this.type?i[this.type].padding:i.basic.padding,this.setCoordinates(this.features),mapboxgl.accessToken=this.key,this.map=new mapboxgl.Map({style:this.style,defaultLanguage:"name_de",dragRotate:i.basic.dragRotate,dragPan:i.basic.dragPan,touchZoomRotate:i.basic.touchZoomRotate,trackResize:i.basic.trackResize,attributionControl:i.basic.attributionControl,maxZoom:i.basic.maxZoom,container:i[this.type].container,center:this.getCenter(),zoom:this.getInitialZoom(),interactive:i[this.type].interactive,scrollZoom:i[this.type].scrollZoom}),this.map.touchZoomRotate.disableRotation(),this.map.once("load",(function(t){e.getPOIs(e.type)})),this.map.on("moveend",(function(t){e.getPOIs(e.type)})),this.map.on("style.load",(function(){!function t(){e.map.isStyleLoaded()?e.additionalLayers.forEach((function(t){void 0===e.map.getLayer(t.name)&&(e.map.addSource(t.name,t.source),e.map.addLayer(t.layer))})):setTimeout(t,200)}()})),this.adjustZoom(),this.addControls();var t=this.features.features;return t.reverse(),t.forEach((function(t){t.properties.newStyle=!0,(new N).setType(t.properties.highlight?"companyPinHighlight":"companyPin").setPopup(e.controls.popup).build(e,t)})),this.featuresForeignAdvertiser&&((t=this.featuresForeignAdvertiser.features).reverse(),t.forEach((function(t){t.properties.newStyle=!0,(new N).setType("companyPin").setPopup(e.controls.popup).build(e,t)}))),this.featuresNoFitBounds&&((t=this.featuresNoFitBounds.features).reverse(),t.forEach((function(t){t.properties.newStyle=!0,(new N).setType("companyPinStar").setPopup(e.controls.popup).build(e,t)}))),this}},{key:"addControls",value:function(){var e=new mapboxgl.AttributionControl,t=new MapboxLanguage({defaultLanguage:"de"});if(this.controls.overlay){var n=new F(this.controls.tracking);this.map.addControl(n,r[this.controls.overlay])}if(this.controls.overlayclose){var o=new q;this.map.addControl(o,r[this.controls.overlayclose])}if(this.controls.fullsize){var i=new mapboxgl.FullscreenControl;this.map.addControl(i,r[this.controls.fullsize])}if(this.controls.styles&&(this.changeStyles=new p,this.map.addControl(this.changeStyles,r[this.controls.styles])),this.controls.poiview&&(this.changePOIview=new c(this),this.map.addControl(this.changePOIview,r[this.controls.poiview])),this.controls.location&&(this.geolocation=new R(this),this.map.addControl(this.geolocation,r[this.controls.location])),this.controls.zoom){var a=new mapboxgl.NavigationControl({showCompass:!1});this.map.addControl(a,r[this.controls.zoom])}this.map.addControl(e,"bottom-left"),this.map.addControl(t),$("#layers input").removeAttr("checked"),$('#layers input[data-style="'+this.style+'"]').attr("checked","")}},{key:"checkPredefinedPoints",value:function(){return!1}},{key:"setCoordinates",value:function(e){var t=this;this.coordinates=[],e.features.forEach((function(e){t.coordinates.push(e.geometry.coordinates)})),this.coordinates.length||(this.coordinates=i.boundsOfAT)}},{key:"setPin",value:function(e,t){var n="";"location"!==e&&(n=e),t.properties={},t.properties.id=n,t.properties.newStyle=!0,this.features.features.push(t),this.setCoordinates(this.features),(new N).setType(""==n?"locationPin":"routePin").setPopup(!1).build(this,t)}},{key:"getInitialZoom",value:function(){return this.zoom&&0!==this.zoom?this.zoom-1:i[this.type].zoom}},{key:"getCenter",value:function(){var e=[],t=[];return this.coordinates.forEach((function(n){e.push(n[0]),t.push(n[1])})),[Math.min.apply(Math,e)+(Math.max.apply(Math,e)-Math.min.apply(Math,e))/2,Math.min.apply(Math,t)+(Math.max.apply(Math,t)-Math.min.apply(Math,t))/2]}},{key:"getBounds",value:function(){return this.coordinates.reduce((function(e,t){return e.extend(t)}),new mapboxgl.LngLatBounds(this.coordinates[0],this.coordinates[0]))}},{key:"centerMap",value:function(e){e?this.map.setCenter(e):this.map.setCenter(this.getCenter())}},{key:"flyMeTo",value:function(e,t,n,o){e||(e=this.getCenter()),t||(t=[0,0]),n||(n=i.basic.animateSpeed),o?this.map.flyTo({center:e,offset:t,speed:n,zoom:o}):this.map.flyTo({center:e,offset:t,speed:n})}},{key:"adjustZoom",value:function(){this.coordinates.length>1&&this.map.fitBounds(this.getBounds(),{padding:this.padding,duration:i.basic.animateDuration})}},{key:"resize",value:function(){if(e.matches){var t=0,n=0;$("#mobileRouteTop .content").is(":visible")&&(t+=$("#mobileRouteTop .content").height()),$("#mobileRouteBottom .content").is(":visible")&&(n+=$("#mobileRouteBottom").height()),$("#mobileCompanyInfo").length&&(n+=$("#mobileCompanyInfo").height()),$("#map").css("top",t),$("#map").css("bottom",n)}this.map.resize()}},{key:"getPOIs",value:function(e){var t=this;$("#"+i[e].container+" .poi").addClass("old");var n,o={callback:"geojson",minx:this.map.getBounds()._sw.lng,miny:this.map.getBounds()._sw.lat,maxx:this.map.getBounds()._ne.lng,maxy:this.map.getBounds()._ne.lat,z:Math.round(this.map.getZoom()+1),type:""};o.type=(n=[],t.poiconfig.forEach((function(e){e.defaultsel&&n.push(e.id)})),n).join(","),""!==o.type&&(this.findPois&&this.findPois.readyState<4&&this.findPois.abort(),this.findPois=$.ajax({type:"GET",data:o,url:"/servlet/findPOIs",context:this,dataType:"JSON",success:function(e){e.geojson.features.forEach((function(e){(new N).setType("poi").build(t,e)}))},complete:function(){$("#"+i[e].container+" .poi.old").remove()}}))}}]),t}());$((function(){if(void 0===n)var n={features:[]};if(void 0===i)var i={features:[]};if(void 0===r)var r={features:[]};var a=$("#mapGLContainer"),s=(new ve).setKey(mapboxGLKey).setType("route").setControls().setZoom(0).setPoiconfig(poiconfig).setFeatures(n).setFeaturesAdditional(i,r).build(routePoints);a.data("map",s),(new Y).setId($("#form-search-map")).setMap(s).build(),$("button.close").click((function(){$(".sidebar").attr("style",o),$("button.close").attr("style",o),$("#searchbar").attr("style",t),$(".routeOverview").empty(),$(".routeDesc").empty(),s.clearMap({route:!0,pins:!0,routepins:!0})})),$(".btn.clear").on("click",(function(e){var t=$(e.currentTarget).prev("input");t.val(""),t.focus()})),$(".showRoute").length&&$(".showRoute").on("click",(function(n){$("#routebar").attr("style",t),e.matches&&$("#mobileRouteTop").attr("style",t),s.checkRouteComplete(),$("#routePincompany").attr("id","routePindestination")})),$(".showPhone").length&&$(".showPhone").on("click",(function(e){$(".showPhone").remove(),$(".callPhone").removeClass("dontShow")}))}))}();
//# sourceMappingURL=mapRoute.js.map